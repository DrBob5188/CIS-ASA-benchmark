<xsl:stylesheet version="1.0"
    xmlns:xsl="http://www.w3.org/1999/XSL/Transform">

    <xsl:output omit-xml-declaration="yes" indent="yes"/>
 
 <!--
    Author: Robert Thomson
    Version: 1.0
    Date: 2022-11-03
    Expected input is a legacy Nunit file generated by Pester
 -->

    <xsl:template match="/*">
        <html>
            <head>
                <title>Infrastructure unit test report</title>
                <style>
                    .styled-table {
                        border-collapse: collapse;
                        margin-left: auto;
                        margin-right: auto;
                        font-size: 0.9em;
                        font-family: sans-serif;
                        min-width: 400px;
                        box-shadow: 0 0 20px rgba(0, 0, 0, 0.15);
                    }

                    .styled-table thead tr {
                        background-color: #009879;
                        color: #ffffff;
                        text-align: left;
                    }

                    .styled-table th,
                    .styled-table td {
                        padding: 12px 15px;
                    }

                    .styled-table tbody tr {
                        border-bottom: 1px solid #dddddd;
                    }

                    .styled-table tbody tr:nth-of-type(even) {
                        background-color: #f3f3f3;
                    }

                    .styled-table tbody tr:last-of-type {
                        border-bottom: 2px solid #009879;
                    }

                    .styled-table tbody tr:hover {
                        font-weight: bold;
                        color: #009879;
                    }
                </style>
            </head>
            <body>
                <h1 align='center'>Infrastructure unit test report using CIS Cisco ASA 9.x Firewall Benchmark v1.0.0 - 04-30-2021</h1>
                <h3 align='center'>Tests run at <xsl:value-of select="/test-results/@date"/><xsl:text> </xsl:text><xsl:value-of select="/test-results/@time"/></h3>
                <table class="styled-table">
                    <thead>
                        <tr>
                            <th>Recommendation</th>
                            <th>Result</th>
                        </tr>
                    </thead>
                    <tbody>
                        <xsl:apply-templates select="//test-suite[@name!='Pester']"></xsl:apply-templates>
                    </tbody>
                </table>
            </body>
        </html>
    </xsl:template>

    <xsl:template match="test-suite">
        <tr>
            <td><B><xsl:value-of select="./@name"/></B></td><td></td>
        </tr>          
        <xsl:apply-templates select=".//test-case"></xsl:apply-templates>
    </xsl:template>

    <xsl:template match="test-case">
        <tr>
            <td><xsl:value-of select="./@name"/></td>
            <xsl:choose>
                <xsl:when test="./@result='Ignored'">
                    <td style="color:#0000ff"><xsl:value-of select="./@result"/></td>
                </xsl:when>
                <xsl:when test="./@result='Failure'">
                    <td style="color:#ff0000"><xsl:value-of select="./@result"/></td>
                </xsl:when>
                <xsl:otherwise>
                    <td><xsl:value-of select="./@result"/></td>
                </xsl:otherwise>
            </xsl:choose>
        </tr>          
    </xsl:template>

    <!--
        Built-in templates: Explicit
        Any unprocessed elements would be output as is, so we match and ignore the rest.
    -->
    <xsl:template match="*" mode="all" priority="-999">
        <xsl:apply-templates mode="current"/>
    </xsl:template>

    <xsl:template match="text()" mode="all">
    </xsl:template>

    <xsl:template match="@*" mode="all">
    </xsl:template>
</xsl:stylesheet>